<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube LongForm Studio</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#0a0a0f;--panel:#111827;--border:#1f2937;--text:#e5e7eb;--muted:#6b7280;--blue:#3b82f6;--green:#10b981;--red:#ef4444;--yellow:#f59e0b;--purple:#8b5cf6}
    body{font-family:-apple-system,'Malgun Gothic',sans-serif;background:var(--bg);color:var(--text);height:100vh;overflow:hidden}
    
    .app{display:flex;flex-direction:column;height:100vh}
    .header{background:var(--panel);border-bottom:1px solid var(--border);padding:12px 24px;display:flex;align-items:center;gap:16px}
    .header h1{font-size:20px}
    .header .nav{margin-left:auto;display:flex;gap:8px}
    .header .nav button{padding:8px 16px;border:1px solid var(--border);border-radius:8px;background:none;color:var(--text);cursor:pointer;font-size:13px;font-family:inherit}
    .header .nav button.active{background:var(--blue);border-color:var(--blue)}
    
    .main{flex:1;overflow-y:auto;padding:24px;max-width:900px;margin:0 auto;width:100%}
    
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:20px}
    .card h2{font-size:18px;margin-bottom:16px;display:flex;align-items:center;gap:8px}
    
    .input{width:100%;padding:12px 16px;background:#0d1117;color:var(--text);border:1px solid var(--border);border-radius:10px;font-size:15px;font-family:inherit}
    .input:focus{outline:none;border-color:var(--blue)}
    .input-group{margin-bottom:16px}
    .input-group label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    
    .btn{padding:12px 24px;border:none;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:all 0.2s;display:inline-flex;align-items:center;gap:8px}
    .btn-big{width:100%;padding:16px;font-size:17px;justify-content:center}
    .btn-blue{background:var(--blue);color:#fff}
    .btn-blue:hover{box-shadow:0 4px 20px rgba(59,130,246,0.4)}
    .btn-green{background:var(--green);color:#fff}
    .btn-green:hover{box-shadow:0 4px 20px rgba(16,185,129,0.4)}
    .btn-outline{background:none;border:1px solid var(--border);color:var(--text)}
    .btn-outline:hover{border-color:var(--blue)}
    .btn:disabled{opacity:0.5;cursor:not-allowed}
    
    .options{display:flex;gap:8px;flex-wrap:wrap}
    .option{padding:8px 16px;border:2px solid var(--border);border-radius:10px;background:none;color:var(--text);cursor:pointer;font-size:13px;font-family:inherit;transition:all 0.2s}
    .option.selected{border-color:var(--blue);background:#1e3a5f}
    
    .progress-container{margin-top:20px}
    .progress-bar{height:8px;background:#1f2937;border-radius:4px;overflow:hidden;margin-bottom:16px}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--blue),var(--purple));border-radius:4px;transition:width 0.5s ease}
    .step{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;margin-bottom:6px;border-left:3px solid var(--border)}
    .step.done{border-left-color:var(--green);background:rgba(16,185,129,0.05)}
    .step.running{border-left-color:var(--blue);background:rgba(59,130,246,0.08)}
    .step.error{border-left-color:var(--red);background:rgba(239,68,68,0.05)}
    .step-icon{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0}
    .step-label{flex:1;font-size:14px}
    .step-detail{font-size:12px;color:var(--muted)}
    
    .voice-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .voice-card{display:flex;align-items:center;gap:12px;padding:14px;background:#0d1117;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:all 0.2s}
    .voice-card:hover{border-color:var(--blue)}
    .voice-card.selected{border-color:var(--blue);background:#1e3a5f}
    .voice-play{width:40px;height:40px;border-radius:50%;border:none;background:var(--blue);color:#fff;font-size:16px;cursor:pointer;flex-shrink:0}
    .voice-play:disabled{background:var(--muted)}
    
    .key-status{display:flex;align-items:center;gap:6px;font-size:12px;margin-top:4px}
    .key-dot{width:8px;height:8px;border-radius:50%}
    .key-dot.ok{background:var(--green)}
    .key-dot.no{background:var(--red)}
    
    .result-box{background:linear-gradient(135deg,#1e3a5f,#4c1d95);border:2px solid var(--purple);border-radius:16px;padding:32px;text-align:center}
    .result-box h2{font-size:24px;margin-bottom:12px}
    .result-box p{color:#ffffffaa;margin-bottom:20px}
    
    .toast{position:fixed;top:20px;right:20px;padding:14px 24px;border-radius:12px;font-size:14px;font-weight:600;z-index:1000;animation:slideIn 0.3s ease;box-shadow:0 8px 30px rgba(0,0,0,0.3)}
    .toast-success{background:var(--green);color:#fff}
    .toast-error{background:var(--red);color:#fff}
    .toast-info{background:var(--blue);color:#fff}
    @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
  </style>
</head>
<body>

<div class="app">
  <header class="header">
    <h1>ğŸ¬ YouTube LongForm Studio</h1>
    <nav class="nav">
      <button class="nav-btn active" data-page="create">ğŸ“ ì˜ìƒ ë§Œë“¤ê¸°</button>
      <button class="nav-btn" data-page="settings">âš™ï¸ ì„¤ì •</button>
      <button class="nav-btn" data-page="voices">ğŸ™ï¸ ìŒì„±</button>
      <button onclick="window.open('http://localhost:3000','_blank')">ğŸ–¥ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
    </nav>
  </header>

  <div class="main">
    <div id="page-create">
      <div class="card">
        <h2>ğŸ¯ ì˜ìƒ ì£¼ì œ</h2>
        <div class="input-group">
          <label>ë¬´ìŠ¨ ì£¼ì œë¡œ ì˜ìƒì„ ë§Œë“¤ê¹Œìš”?</label>
          <textarea class="input" id="topicInput" rows="3" placeholder="ì˜ˆ: 2026ë…„ ìˆ˜ë„ê¶Œ ì•„íŒŒíŠ¸ ê°€ê²© ì „ë§&#10;ì˜ˆ: ë¯¸êµ­ ê¸ˆë¦¬ ì¸í•˜ê°€ í•œêµ­ ê²½ì œì— ë¯¸ì¹˜ëŠ” ì˜í–¥&#10;ì˜ˆ: ë¹„íŠ¸ì½”ì¸ ë°˜ê°ê¸° ì´í›„ ì‹œì¥ ì „ë§"></textarea>
        </div>

        <div class="input-group">
          <label>ì¹´í…Œê³ ë¦¬</label>
          <div class="options" id="categoryOptions"></div>
        </div>

        <div class="input-group">
          <label>ì˜ìƒ ê¸¸ì´</label>
          <div class="options" id="durationOptions"></div>
        </div>

        <div class="input-group">
          <label>ë§íˆ¬</label>
          <div class="options" id="toneOptions"></div>
        </div>

        <div class="input-group" style="margin-top: 16px;">
          <label for="bgmVolume" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--muted);">
            ğŸµ ë°°ê²½ìŒì•… ë³¼ë¥¨: <span id="bgmVolumeLabel">15%</span>
          </label>
          <input
            type="range"
            id="bgmVolume"
            min="0"
            max="100"
            value="15"
            style="width: 100%; cursor: pointer; accent-color: var(--blue);"
            oninput="document.getElementById('bgmVolumeLabel').textContent = this.value + '%'"
          />
          <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-top: 4px;">
            <span>ğŸ”‡ ìŒì†Œê±°</span>
            <span>ğŸ”Š ìµœëŒ€</span>
          </div>
        </div>

        <button class="btn btn-blue btn-big" id="generateBtn" onclick="startGenerate()">
          ğŸš€ ì˜ìƒ ìë™ ìƒì„± ì‹œì‘
        </button>
        <div style="text-align:center;margin-top:8px;font-size:12px;color:var(--muted)">
          ì£¼ì œë§Œ ì…ë ¥í•˜ë©´ ëŒ€ë³¸ â†’ ìŒì„± â†’ íš¨ê³¼ìŒê¹Œì§€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤
        </div>
      </div>

      <div class="card" id="progressCard" style="display:none">
        <h2>ğŸ”„ ìƒì„± ì§„í–‰ ì¤‘...</h2>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width:0%"></div>
        </div>
        <div id="progressPercent" style="text-align:center;font-size:14px;color:var(--muted);margin-bottom:16px">0%</div>
        <div id="progressSteps"></div>
      </div>

      <div class="card" id="resultCard" style="display:none">
        <div class="result-box">
          <h2>ğŸ‰ ì˜ìƒ ìƒì„± ì™„ë£Œ!</h2>
          <p>ëŒ€ë³¸, ìŒì„±, íš¨ê³¼ìŒì´ ëª¨ë‘ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
          <div style="display:flex;gap:12px;justify-content:center">
            <button class="btn btn-green" onclick="window.open('http://localhost:3000','_blank')">
              ğŸ–¥ï¸ Remotionì—ì„œ ë¯¸ë¦¬ë³´ê¸°
            </button>
            <button class="btn btn-outline" onclick="resetForm()">
              ğŸ“ ìƒˆ ì˜ìƒ ë§Œë“¤ê¸°
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="page-settings" style="display:none">
      <div class="card">
        <h2>ğŸ”‘ API í‚¤ ì„¤ì •</h2>
        <p style="font-size:13px;color:var(--muted);margin-bottom:16px">
          ì˜ìƒ ìƒì„±ì— í•„ìš”í•œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. í‚¤ëŠ” ì•ˆì „í•˜ê²Œ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤.
        </p>

        <div class="input-group">
          <label>ElevenLabs API í‚¤ (ìŒì„± ìƒì„±ìš©)</label>
          <input class="input" id="settingsElevenLabs" type="password" placeholder="sk_..." />
          <div class="key-status" id="elevenLabsStatus"></div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px">
            <a href="https://elevenlabs.io/app/settings/api-keys" target="_blank" style="color:var(--blue)">ì—¬ê¸°ì„œ ë¬´ë£Œ í‚¤ ë°œê¸‰ â†’</a>
          </div>
        </div>

        <div class="input-group">
          <label>Gemini API í‚¤ (ëŒ€ë³¸ ìƒì„±ìš©)</label>
          <input class="input" id="settingsGemini" type="password" placeholder="AIza..." />
          <div class="key-status" id="geminiStatus"></div>
          <div style="font-size:11px;color:var(--muted);margin-top:4px">
            <a href="https://aistudio.google.com/apikey" target="_blank" style="color:var(--blue)">ì—¬ê¸°ì„œ ë¬´ë£Œ í‚¤ ë°œê¸‰ â†’</a>
          </div>
        </div>

        <div style="display:flex;gap:8px">
          <button class="btn btn-blue" onclick="saveSettingsFromUI()">ğŸ’¾ ì €ì¥</button>
          <button class="btn btn-outline" onclick="validateKeys()">ğŸ” í‚¤ ê²€ì¦</button>
        </div>
      </div>
    </div>

    <div id="page-voices" style="display:none">
      <div class="card">
        <h2>ğŸ™ï¸ ë‚˜ë ˆì´ì…˜ ìŒì„± ì„ íƒ</h2>
        <p style="font-size:13px;color:var(--muted);margin-bottom:16px">
          ì˜ìƒì— ì‚¬ìš©í•  ìŒì„±ì„ ì„ íƒí•˜ê³  ë¯¸ë¦¬ ë“¤ì–´ë³´ì„¸ìš”.
        </p>
        <div id="voiceList" class="voice-grid"></div>
      </div>
    </div>
  </div>
</div>

<script>
let selectedCategory = 'economy';
let selectedDuration = 10;
let selectedTone = 'youtuber';
let selectedVoiceId = 'pNInz6obpgDQGcFmaJgB';
let eventSource = null;

const CATEGORIES = [
  {v:'economy',l:'ğŸ’° ê²½ì œ'},{v:'realestate',l:'ğŸ  ë¶€ë™ì‚°'},
  {v:'current',l:'ğŸ“° ì‹œì‚¬'},{v:'tech',l:'ğŸ’» ê¸°ìˆ '},
  {v:'finance',l:'ğŸ“ˆ ê¸ˆìœµ'},{v:'policy',l:'ğŸ›ï¸ ì •ì±…'}
];
const DURATIONS = [{v:5,l:'5ë¶„'},{v:8,l:'8ë¶„'},{v:10,l:'10ë¶„'},{v:15,l:'15ë¶„'}];
const TONES = [{v:'anchor',l:'ğŸ™ï¸ ì•µì»¤'},{v:'youtuber',l:'ğŸ¬ ìœ íŠœë²„'},{v:'documentary',l:'ğŸ¥ ë‹¤í'},{v:'lecture',l:'ğŸ“š ê°•ì˜'}];
const VOICES = [
  {id:'pNInz6obpgDQGcFmaJgB',name:'Adam',desc:'ê¹Šê³  ì›…ì¥í•œ ë‚¨ì„± ëª©ì†Œë¦¬. ë‹¤íë©˜í„°ë¦¬, ë‰´ìŠ¤ í•´ì„¤ì— ìµœì ì…ë‹ˆë‹¤.',tags:['ë‚¨ì„±','ì›…ì¥','ë‹¤í','ì €ìŒ']},
  {id:'nPczCjzI2devNBz1zQrb',name:'Brian',desc:'ìš¸ë¦¼ ìˆëŠ” ì¤‘ë…„ ë‚¨ì„±. ê´‘ê³ , ë‚˜ë˜ì´ì…˜ì— ì í•©í•©ë‹ˆë‹¤.',tags:['ë‚¨ì„±','ìš¸ë¦¼','ê´‘ê³ ','ë‚˜ë˜ì´ì…˜']},
  {id:'pqHfZKP75CvOlQylNhV4',name:'Bill',desc:'ë”°ëœ»í•˜ê³  í˜ ìˆëŠ” ë‚¨ì„±. ë‹¤íë©˜í„°ë¦¬, ìŠ¤í† ë¦¬í…”ë§ì— ì¢‹ìŠµë‹ˆë‹¤.',tags:['ë‚¨ì„±','ë”°ëœ»','ë‹¤í','ìŠ¤í† ë¦¬']},
  {id:'TxGEqnHWrfWFTfGW9XjX',name:'Josh',desc:'ê¹Šê³  ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” ì²­ë…„. ìœ íŠœë¸Œ, ì˜ˆëŠ¥ ì½˜í…ì¸  ì¶”ì²œ.',tags:['ë‚¨ì„±','ì—ë„ˆì§€','ìœ íŠœë¸Œ','ì²­ë…„']},
  {id:'VR6AewLTigWG4xSOukaG',name:'Arnold',desc:'ë˜ë ·í•˜ê³  ì„ ëª…í•œ ì¤‘ë…„ ë‚¨ì„±. êµìœ¡, ì„¤ëª… ì˜ìƒì— ì í•©í•©ë‹ˆë‹¤.',tags:['ë‚¨ì„±','ë˜ë ·','êµìœ¡','ì„¤ëª…']},
  {id:'onwK4e9ZLuTAKqWW03F9',name:'Daniel',desc:'ê¹Šì€ ì˜êµ­ì‹ ë‚¨ì„±. ë‰´ìŠ¤ ì•µì»¤, ì‹œì‚¬ í”„ë¡œê·¸ë¨ì— ì–´ìš¸ë¦½ë‹ˆë‹¤.',tags:['ë‚¨ì„±','ì•µì»¤','ë‰´ìŠ¤','ì˜êµ­']},
  {id:'29vD33N1CtxCmqQRPOHJ',name:'Drew',desc:'ê· í˜• ì¡íŒ ì¤‘ë…„ ë‚¨ì„±. ë‰´ìŠ¤, ë¦¬í¬íŠ¸ì— ì í•©í•©ë‹ˆë‹¤.',tags:['ë‚¨ì„±','ë‰´ìŠ¤','ê· í˜•','ë¦¬í¬íŠ¸']},
  {id:'5Q0t7uMcjvnagumLfvZi',name:'Paul',desc:'í˜„ì¥ê° ìˆëŠ” ë‚¨ì„±. ë‰´ìŠ¤ ë¦¬í¬í„°, í˜„ì¥ ì¤‘ê³„ì— ìµœì .',tags:['ë‚¨ì„±','ë¦¬í¬í„°','í˜„ì¥','ë‰´ìŠ¤']},
  {id:'Zlb1dXrM653N07WRdFW3',name:'Joseph',desc:'ì°¨ë¶„í•œ ì˜êµ­ ë‚¨ì„±. ë‰´ìŠ¤, ê²©ì‹ ìˆëŠ” ë‚˜ë˜ì´ì…˜.',tags:['ë‚¨ì„±','ì°¨ë¶„','ì˜êµ­','ê²©ì‹']},
  {id:'ZQe5CZNOzWyzPSCn5a3c',name:'James',desc:'ì°¨ë¶„í•œ í˜¸ì£¼ ë‚¨ì„±. ë‰´ìŠ¤, êµì–‘ í”„ë¡œê·¸ë¨.',tags:['ë‚¨ì„±','í˜¸ì£¼','ì°¨ë¶„','êµì–‘']},
  {id:'ErXwobaYiN019PkySvjV',name:'Antoni',desc:'ì¹œê·¼í•˜ê³  í¸ì•ˆí•œ ë‚¨ì„±. ìœ íŠœë²„, ë¸Œì´ë¡œê·¸ì— ë”± ë§ìŠµë‹ˆë‹¤.',tags:['ë‚¨ì„±','ì¹œê·¼','ìœ íŠœë²„','í¸ì•ˆ']},
  {id:'IKne3meq5aSn9XLyUdCD',name:'Charlie',desc:'ìì‹ ê° ë„˜ì¹˜ëŠ” í˜¸ì£¼ ì²­ë…„. ìºì£¼ì–¼ ì½˜í…ì¸  ì¶”ì²œ.',tags:['ë‚¨ì„±','í˜¸ì£¼','ìì‹ ê°','ìºì£¼ì–¼']},
  {id:'iP95p4xoKVk53GoZ742B',name:'Chris',desc:'ìì—°ìŠ¤ëŸ½ê³  í¸ì•ˆí•œ ë‚¨ì„±. ì¼ìƒ ì½˜í…ì¸ , ë¦¬ë·°.',tags:['ë‚¨ì„±','ìì—°ìŠ¤ëŸ¬ì›€','ì¼ìƒ','ë¦¬ë·°']},
  {id:'TX3LPaxmHKxFdv7VOQHJ',name:'Liam',desc:'ì—ë„ˆì§€ì™€ ë”°ëœ»í•¨ì˜ ì²­ë…„. ìˆí¼, ë¦´ìŠ¤ì— ì í•©.',tags:['ë‚¨ì„±','ì—ë„ˆì§€','ìˆí¼','ë”°ëœ»']},
  {id:'bVMeCyTHy58xNoL34h3p',name:'Jeremy',desc:'í¥ë¶„ëœ ì•„ì´ë¦¬ì‹œ ì²­ë…„. ë¦¬ë·°, í•˜ì´ë¼ì´íŠ¸.',tags:['ë‚¨ì„±','í¥ë¶„','ë¦¬ë·°','ì•„ì´ë¦¬ì‹œ']},
  {id:'CYw3kZ02Hs0563khs1Fj',name:'Dave',desc:'ëŒ€í™”ì²´ ì˜êµ­ ì²­ë…„. ìºì£¼ì–¼, ê²Œì„ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ëŒ€í™”ì²´','ì˜êµ­','ê²Œì„']},
  {id:'CwhRBWXzGAHq8TQ4Fs17',name:'Roger',desc:'í¸ì•ˆí•˜ê³  ëŠê¸‹í•œ ë‚¨ì„±. íŒŸìºìŠ¤íŠ¸, ì¼ìƒ ëŒ€í™”.',tags:['ë‚¨ì„±','í¸ì•ˆ','íŒŸìºìŠ¤íŠ¸','ëŠê¸‹']},
  {id:'bIHbv24MWmeRgasZH58o',name:'Will',desc:'ëŒ€í™”ì²´ë¡œ í¸ì•ˆí•œ ë‚¨ì„±. ìºì£¼ì–¼ ë‚˜ë˜ì´ì…˜.',tags:['ë‚¨ì„±','ëŒ€í™”ì²´','ìºì£¼ì–¼','í¸ì•ˆ']},
  {id:'N2lVS1w4EtoT3dr4eOWO',name:'Callum',desc:'ê±°ì¹œ í—ˆìŠ¤í‚¤ ë‚¨ì„±. ê²Œì„, ë¯¸ìŠ¤í„°ë¦¬ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','í—ˆìŠ¤í‚¤','ê²Œì„','ë¯¸ìŠ¤í„°ë¦¬']},
  {id:'2EiwWnXFnvU5JabPnv8n',name:'Clyde',desc:'ì „ìŸ ë² í…Œë‘ ë‚¨ì„±. ê²Œì„ ìºë¦­í„°, ë“œë¼ë§ˆ.',tags:['ë‚¨ì„±','ë² í…Œë‘','ê²Œì„','ë“œë¼ë§ˆ']},
  {id:'D38z5RcWu1voky8WS1ja',name:'Fin',desc:'ì•„ì´ë¦¬ì‹œ ë…¸ì¸ ë‚¨ì„±. ìŠ¤í† ë¦¬í…”ë§, íŒíƒ€ì§€.',tags:['ë‚¨ì„±','ì•„ì´ë¦¬ì‹œ','ë…¸ì¸','íŒíƒ€ì§€']},
  {id:'SOYHLrjzK2X1ezoPC6cr',name:'Harry',desc:'ê¸´ì¥ê° ìˆëŠ” ì²­ë…„. ê²Œì„, ì•¡ì…˜ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ê¸´ì¥','ê²Œì„','ì•¡ì…˜']},
  {id:'t0jbNlBVZ17f02VDIeMI',name:'Jessie',desc:'ê±°ì¹œ ë…¸ì¸ ë‚¨ì„±. ì„œë¶€ê·¹, ìºë¦­í„° ìŒì„±.',tags:['ë‚¨ì„±','ê±°ì¹œ','ë…¸ì¸','ìºë¦­í„°']},
  {id:'ODq5zmih8GrVes37Dizd',name:'Patrick',desc:'ìš°ë ì°¬ ë‚¨ì„±. ê²Œì„ ìºë¦­í„°, ê´‘ê³ .',tags:['ë‚¨ì„±','ìš°ë ì°¬','ê²Œì„','ê´‘ê³ ']},
  {id:'GBv7mTt0atIp3Br8iCZE',name:'Thomas',desc:'ë¶€ë“œëŸ½ê³  ì°¨ë¶„í•œ ë‚¨ì„±. ëª…ìƒ, ASMR.',tags:['ë‚¨ì„±','ì°¨ë¶„','ëª…ìƒ','ASMR']},
  {id:'g5CIjZEefAph4nQFvHAz',name:'Ethan',desc:'ì†ì‚­ì´ëŠ” ë‚¨ì„±. ASMR, ìˆ˜ë©´ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ì†ì‚­ì„','ASMR','ìˆ˜ë©´']},
  {id:'yoZ06aMxZJJ28mfd3POQ',name:'Sam',desc:'í—ˆìŠ¤í‚¤í•œ ì²­ë…„. ë‚˜ë˜ì´ì…˜, ì¸ë”” ì½˜í…ì¸ .',tags:['ë‚¨ì„±','í—ˆìŠ¤í‚¤','ë‚˜ë˜ì´ì…˜','ì¸ë””']},
  {id:'zcAOhNBS3c14rBihAFp1',name:'Giovanni',desc:'ì´íƒˆë¦¬ì•ˆ ì•…ì„¼íŠ¸ ì²­ë…„. ì˜¤ë””ì˜¤ë¶, ê°ì„± ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ì´íƒˆë¦¬ì•ˆ','ì˜¤ë””ì˜¤ë¶','ê°ì„±']},
  {id:'JBFqnCBsd6RMkjVDRZzb',name:'George',desc:'ë”°ëœ»í•œ ì˜êµ­ ë‚¨ì„±. ë‚˜ë˜ì´ì…˜, ì˜¤ë””ì˜¤ë¶.',tags:['ë‚¨ì„±','ì˜êµ­','ë”°ëœ»','ì˜¤ë””ì˜¤ë¶']},
  {id:'flq6f7yk4E4fJM5XTYuZ',name:'Michael',desc:'ë…¸ë ¨í•œ ë¯¸êµ­ ë‚¨ì„±. ì˜¤ë””ì˜¤ë¶, ì—­ì‚¬ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ë…¸ë ¨','ì˜¤ë””ì˜¤ë¶','ì—­ì‚¬']},
  {id:'SAz9YHcvj6GT2YYXdXww',name:'River',desc:'í¸ì•ˆí•˜ê³  ì¤‘ì„±ì ì¸ ëª©ì†Œë¦¬. ë‚˜ë˜ì´ì…˜, ëŒ€í™”.',tags:['ì¤‘ì„±','í¸ì•ˆ','ë‚˜ë˜ì´ì…˜','ëŒ€í™”']},
  {id:'cjVigY5qzO86Huf0OWal',name:'Eric',desc:'ë¶€ë“œëŸ¬ìš´ í…Œë„ˆ ë‚¨ì„±. AI ì—ì´ì „íŠ¸, ì•ˆë‚´ ìŒì„±.',tags:['ë‚¨ì„±','í…Œë„ˆ','AI','ì•ˆë‚´']},
  {id:'knrPHWnBmmDHMoiMeP3l',name:'Santa',desc:'ì‚°íƒ€í´ë¡œìŠ¤! íŠ¹ë³„ ì´ë²¤íŠ¸, ì‹œì¦Œ ì½˜í…ì¸ .',tags:['ë‚¨ì„±','ì‚°íƒ€','ì´ë²¤íŠ¸','ì‹œì¦Œ']},
  {id:'EXAVITQu4vr4xnSDxMaL',name:'Sarah',desc:'ë”°ëœ»í•˜ê³  ì „ë¬¸ì ì¸ ì—¬ì„±. ë‰´ìŠ¤, êµìœ¡ ì½˜í…ì¸ .',tags:['ì—¬ì„±','ì „ë¬¸','ë‰´ìŠ¤','êµìœ¡']},
  {id:'Xb7hH8MSUJpSbSDYk0k2',name:'Alice',desc:'ìì‹ ê° ìˆëŠ” ì˜êµ­ ì—¬ì„±. ì´ëŸ¬ë‹, êµìœ¡.',tags:['ì—¬ì„±','ì˜êµ­','ìì‹ ê°','êµìœ¡']},
  {id:'pFZP5JQG7iQjIQuC4Bku',name:'Lily',desc:'ë²¨ë²³ ê°™ì€ ì˜êµ­ ì—¬ì„±. ë‰´ìŠ¤, ë‚˜ë˜ì´ì…˜.',tags:['ì—¬ì„±','ì˜êµ­','ë²¨ë²³','ë‚˜ë˜ì´ì…˜']},
  {id:'XrExE9yKIg1WjnnlVkGX',name:'Matilda',desc:'ë”°ëœ»í•œ ì „ë¬¸ ì—¬ì„±. ë‹¤ëª©ì  ë‚˜ë˜ì´ì…˜.',tags:['ì—¬ì„±','ë”°ëœ»','ì „ë¬¸','ë‹¤ëª©ì ']},
  {id:'9BWtsMINqrJLrRacOk9x',name:'Aria',desc:'ì°¨ë¶„í•˜ê³  í—ˆìŠ¤í‚¤í•œ ì—¬ì„±. ë‚˜ë˜ì´ì…˜, ë‹¤í.',tags:['ì—¬ì„±','ì°¨ë¶„','í—ˆìŠ¤í‚¤','ë‹¤í']},
  {id:'21m00Tcm4TlvDq8ikWAM',name:'Rachel',desc:'ëŒ€í™”í•˜ë“¯ í¸ì•ˆí•œ ì—¬ì„±. ë¸Œì´ë¡œê·¸, ë¦¬ë·°.',tags:['ì—¬ì„±','í¸ì•ˆ','ë¸Œì´ë¡œê·¸','ëŒ€í™”']},
  {id:'AZnzlk1XvdvUeBnXmlld',name:'Domi',desc:'ê°•í•˜ê³  ë˜ë ·í•œ ì Šì€ ì—¬ì„±. ë‚˜ë˜ì´ì…˜, ê´‘ê³ .',tags:['ì—¬ì„±','ê°•í•¨','ë˜ë ·','ê´‘ê³ ']},
  {id:'MF3mGyEYCl7XYWbV9V6O',name:'Elli',desc:'ì°¨ë¶„í•˜ê³  ì§€ì ì¸ ì—¬ì„±. í•´ì„¤, ë¶„ì„.',tags:['ì—¬ì„±','ì°¨ë¶„','ì§€ì ','í•´ì„¤']},
  {id:'FGY2WhTYpPnrIDTdsKH5',name:'Laura',desc:'ë°ê³  ì¾Œí™œí•œ ì—¬ì„±. ìœ íŠœë¸Œ, íŠ¸ë Œë“œ ì½˜í…ì¸ .',tags:['ì—¬ì„±','ë°ìŒ','ì¾Œí™œ','íŠ¸ë Œë“œ']},
  {id:'cgSgspJ2msm6clMCkdW9',name:'Jessica',desc:'ì¸ê¸° ìˆëŠ” ì Šì€ ì—¬ì„±. íŠ¸ë Œë””í•œ ì½˜í…ì¸ .',tags:['ì—¬ì„±','ì¸ê¸°','íŠ¸ë Œë””','ì Šì€']},
  {id:'pMsXgVXv3BLzUgSXRplE',name:'Serena',desc:'ìƒëƒ¥í•˜ê³  ë°ì€ ì—¬ì„±. ì•ˆë‚´, ì¸í„°ë™í‹°ë¸Œ.',tags:['ì—¬ì„±','ìƒëƒ¥','ì•ˆë‚´','ì¸í„°ë™í‹°ë¸Œ']},
  {id:'XB0fDUnXU5powFXDhCwa',name:'Charlotte',desc:'ì„¸ë ¨ë˜ê³  ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ì—¬ì„±. í”„ë¦¬ë¯¸ì—„ ë‚˜ë˜ì´ì…˜.',tags:['ì—¬ì„±','ì„¸ë ¨','ê³ ê¸‰','í”„ë¦¬ë¯¸ì—„']},
  {id:'LcfcDJNUP1GQjkzn1xUU',name:'Emily',desc:'ê³ ìš”í•˜ê³  ì°¨ë¶„í•œ ì—¬ì„±. ëª…ìƒ, íë§.',tags:['ì—¬ì„±','ê³ ìš”','ëª…ìƒ','íë§']},
  {id:'piTKgcLEGmPE4e6mEKli',name:'Nicole',desc:'ì†ì‚­ì´ëŠ” ì—¬ì„±. ASMR, ì˜¤ë””ì˜¤ë¶.',tags:['ì—¬ì„±','ì†ì‚­ì„','ASMR','ì˜¤ë””ì˜¤ë¶']},
  {id:'ThT5KcBeYPX3keUQqHPh',name:'Dorothy',desc:'ë°ê³  ìƒëƒ¥í•œ ì—¬ì„±. ë™í™”, í‚¤ì¦ˆ ì½˜í…ì¸ .',tags:['ì—¬ì„±','ë°ìŒ','ë™í™”','í‚¤ì¦ˆ']},
  {id:'oWAxZDx7w5VEj9dCyTzz',name:'Grace',desc:'ë‚¨ë¶€ ì•…ì„¼íŠ¸ ì Šì€ ì—¬ì„±. ì˜¤ë””ì˜¤ë¶, ê°ì„±.',tags:['ì—¬ì„±','ë‚¨ë¶€','ì˜¤ë””ì˜¤ë¶','ê°ì„±']},
  {id:'jsCqWAovK2LkecY7zXl4',name:'Freya',desc:'ììœ ë¡œìš´ ì Šì€ ì—¬ì„±. ë‹¤ì–‘í•œ ì½˜í…ì¸ .',tags:['ì—¬ì„±','ììœ ','ë‹¤ì–‘','ì½˜í…ì¸ ']},
  {id:'z9fAnlkpzviPz146aGWa',name:'Glinda',desc:'ë§ˆë…€ ìºë¦­í„° ì—¬ì„±. ê²Œì„, íŒíƒ€ì§€.',tags:['ì—¬ì„±','ë§ˆë…€','ê²Œì„','íŒíƒ€ì§€']},
  {id:'jBpfuIE2acCO8z3wKNLl',name:'Gigi',desc:'ì•„ê¸° ê°™ì€ ì—¬ì„±. ì• ë‹ˆë©”ì´ì…˜, ìºë¦­í„°.',tags:['ì—¬ì„±','ê·€ì—¬ì›€','ì• ë‹ˆ','ìºë¦­í„°']},
  {id:'zrHiDhphv9ZnVXBqCLjz',name:'Mimi',desc:'ì¥ë‚œìŠ¤ëŸ¬ìš´ ì–´ë¦° ì—¬ì„±. ì• ë‹ˆë©”ì´ì…˜, ìºë¦­í„°.',tags:['ì—¬ì„±','ì¥ë‚œ','ì• ë‹ˆ','ìºë¦­í„°']},
];

function init() {
  renderOptions('categoryOptions', CATEGORIES, selectedCategory, 'category');
  renderOptions('durationOptions', DURATIONS, selectedDuration, 'duration');
  renderOptions('toneOptions', TONES, selectedTone, 'tone');
  renderVoices();
  loadSettingsUI();

  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const page = btn.getAttribute('data-page');
      if (page) showPage(page, btn);
    });
  });
}

function renderOptions(containerId, options, selectedVal, type) {
  const c = document.getElementById(containerId);
  c.innerHTML = options.map(o => {
    const val = typeof o.v === 'number' ? o.v : o.v;
    const isSelected = o.v === selectedVal;
    return `<button class="option ${isSelected ? 'selected' : ''}" data-type="${type}" data-value="${val}">${o.l}</button>`;
  }).join('');

  c.querySelectorAll('.option').forEach(opt => {
    opt.addEventListener('click', () => {
      const val = opt.getAttribute('data-value');
      const type = opt.getAttribute('data-type');
      if (type === 'category') { selectedCategory = val; }
      else if (type === 'duration') { selectedDuration = parseInt(val, 10); }
      else if (type === 'tone') { selectedTone = val; }
      const opts = type === 'category' ? CATEGORIES : type === 'duration' ? DURATIONS : TONES;
      const sel = type === 'category' ? selectedCategory : type === 'duration' ? selectedDuration : selectedTone;
      renderOptions(containerId, opts, sel, type);
    });
  });
}

function showPage(page, activeBtn) {
  ['create','settings','voices'].forEach(p => {
    document.getElementById('page-'+p).style.display = p===page ? 'block' : 'none';
  });
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  if (activeBtn) activeBtn.classList.add('active');
}

async function loadSettingsUI() {
  try {
    const res = await fetch('/api/settings');
    const data = await res.json();
    document.getElementById('settingsElevenLabs').placeholder = data.hasElevenLabsKey ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢(ì €ì¥ë¨)' : 'sk_...';
    document.getElementById('settingsGemini').placeholder = data.hasGeminiKey ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢(ì €ì¥ë¨)' : 'AIza...';
    if (data.selectedVoiceId) selectedVoiceId = data.selectedVoiceId;

    if (!data.hasElevenLabsKey || !data.hasGeminiKey) {
      showToast('âš™ï¸ ë¨¼ì € ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'info');
    }
  } catch(e) {}
}

async function saveSettingsFromUI() {
  const el = document.getElementById('settingsElevenLabs').value;
  const gm = document.getElementById('settingsGemini').value;
  
  try {
    const res = await fetch('/api/settings', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        elevenLabsKey: el || undefined,
        geminiKey: gm || undefined,
        selectedVoiceId,
      })
    });
    const data = await res.json();
    showToast('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    document.getElementById('settingsElevenLabs').value = '';
    document.getElementById('settingsGemini').value = '';
    loadSettingsUI();
  } catch(e) {
    showToast('âŒ ì €ì¥ ì‹¤íŒ¨', 'error');
  }
}

async function validateKeys() {
  showToast('ğŸ” í‚¤ ê²€ì¦ ì¤‘...', 'info');
  try {
    const res = await fetch('/api/validate-keys', {method:'POST'});
    const data = await res.json();
    
    document.getElementById('elevenLabsStatus').innerHTML = data.elevenlabs
      ? '<span class="key-dot ok"></span><span style="color:var(--green)">âœ… ìœ íš¨í•œ í‚¤</span>'
      : '<span class="key-dot no"></span><span style="color:var(--red)">âŒ ìœ íš¨í•˜ì§€ ì•ŠìŒ</span>';
    
    document.getElementById('geminiStatus').innerHTML = data.gemini
      ? '<span class="key-dot ok"></span><span style="color:var(--green)">âœ… ìœ íš¨í•œ í‚¤</span>'
      : '<span class="key-dot no"></span><span style="color:var(--red)">âŒ ìœ íš¨í•˜ì§€ ì•ŠìŒ</span>';
    
    if (data.elevenlabs && data.gemini) showToast('âœ… ëª¨ë“  í‚¤ê°€ ìœ íš¨í•©ë‹ˆë‹¤!', 'success');
    else showToast('âš ï¸ ì¼ë¶€ í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
  } catch(e) {
    showToast('âŒ ê²€ì¦ ì‹¤íŒ¨', 'error');
  }
}

function renderVoices() {
  const c = document.getElementById('voiceList');
  c.innerHTML = VOICES.map(v => `
    <div class="voice-card ${v.id===selectedVoiceId?'selected':''}" onclick="selectVoice('${v.id}')">
      <div style="flex:1">
        <div style="font-size:15px;font-weight:700;margin-bottom:4px">${v.desc}</div>
        <div style="display:flex;gap:4px">${v.tags.map(t=>`<span style="font-size:11px;color:var(--muted);background:var(--bg);padding:2px 8px;border-radius:4px">${t}</span>`).join('')}</div>
      </div>
      <button class="voice-play" onclick="event.stopPropagation();previewVoice('${v.id}')" title="ë¯¸ë¦¬ë“£ê¸°">â–¶</button>
    </div>
  `).join('');
}

function selectVoice(id) {
  selectedVoiceId = id;
  renderVoices();
  fetch('/api/settings', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({selectedVoiceId:id})
  });
  showToast('ğŸ™ï¸ ìŒì„±ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
}

let currentAudio = null;
async function previewVoice(id) {
  if (currentAudio) { currentAudio.pause(); currentAudio=null; }
  try {
    const res = await fetch('/api/voice-preview', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({voiceId:id})
    });
    if (!res.ok) throw new Error('ë¯¸ë¦¬ë“£ê¸° ì‹¤íŒ¨. ì„¤ì •ì—ì„œ API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
    const blob = await res.blob();
    currentAudio = new Audio(URL.createObjectURL(blob));
    currentAudio.play();
    currentAudio.onended = () => currentAudio = null;
  } catch(e) {
    showToast('âŒ ' + e.message, 'error');
  }
}

async function startGenerate() {
  const topic = document.getElementById('topicInput').value.trim();
  if (!topic) { showToast('âŒ ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error'); return; }

  document.getElementById('generateBtn').disabled = true;
  document.getElementById('progressCard').style.display = 'block';
  document.getElementById('resultCard').style.display = 'none';

  if (eventSource) eventSource.close();
  eventSource = new EventSource('/api/progress');
  eventSource.onmessage = (e) => {
    const data = JSON.parse(e.data);
    updateProgressUI(data);
  };

  const bgmVolumeSlider = document.getElementById('bgmVolume');
  const bgmVolume = bgmVolumeSlider ? parseInt(bgmVolumeSlider.value, 10) / 100 : 0.15;

  try {
    const res = await fetch('/api/generate', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        topic,
        category: selectedCategory,
        duration: selectedDuration,
        tone: selectedTone,
        bgmVolume,
      })
    });
    const data = await res.json();
    if (!res.ok) {
      showToast('âŒ ' + (data.error || 'ìƒì„± ì‹¤íŒ¨'), 'error');
      document.getElementById('generateBtn').disabled = false;
    }
  } catch(e) {
    showToast('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨. npm run server ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.', 'error');
    document.getElementById('generateBtn').disabled = false;
  }
}

function updateProgressUI(data) {
  document.getElementById('progressFill').style.width = data.progress + '%';
  document.getElementById('progressPercent').textContent = data.progress + '%';
  
  const stepsHtml = (data.steps||[]).map(s => {
    const colors = {pending:'var(--border)',running:'var(--blue)',done:'var(--green)',error:'var(--red)'};
    const icons = {pending:'â³',running:'âš¡',done:'âœ…',error:'âŒ'};
    return `<div class="step ${s.status}">
      <div class="step-icon" style="background:${colors[s.status]}">${icons[s.status]}</div>
      <div>
        <div class="step-label">${s.label}</div>
        ${s.detail?`<div class="step-detail">${s.detail}</div>`:''}
      </div>
    </div>`;
  }).join('');
  document.getElementById('progressSteps').innerHTML = stepsHtml;

  if (data.status === 'complete') {
    document.getElementById('resultCard').style.display = 'block';
    document.getElementById('generateBtn').disabled = false;
    if (eventSource) eventSource.close();
    showToast('ğŸ‰ ì˜ìƒ ìƒì„± ì™„ë£Œ!', 'success');
  }
  if (data.status === 'error') {
    document.getElementById('generateBtn').disabled = false;
    if (eventSource) eventSource.close();
    showToast('âŒ ì˜¤ë¥˜: ' + (data.error||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
  }
}

function resetForm() {
  document.getElementById('topicInput').value = '';
  document.getElementById('progressCard').style.display = 'none';
  document.getElementById('resultCard').style.display = 'none';
}

function showToast(msg, type='info') {
  const toast = document.createElement('div');
  toast.className = 'toast toast-' + type;
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

init();
</script>

</body>
</html>
